<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot - UNÄ°TE</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <!-- Navigation -->
    <nav>
        <div class="container">
            <div class="logo">ğŸ“ UNÄ°TE</div>
            <ul class="nav-links">
                <li><a href="/">Ana Sayfa</a></li>
                <li><a href="/chatbot.html" class="active">Chatbot</a></li>
                <li><a href="/courses.html">Dersler</a></li>
                <li><a href="/professors.html">Hocalar</a></li>
                <li><a href="/matching.html">EÅŸleÅŸtirme</a></li>
                <li><a href="/activities.html">Etkinlikler</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <div class="chat-container card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ¤– UNÄ°TE AsistanÄ±</h2>
                    <p class="card-description">Size nasÄ±l yardÄ±mcÄ± olabilirim?</p>
                </div>

                <!-- Chat Messages -->
                <div class="chat-messages" id="chatMessages">
                    <div class="message message-bot">
                        <p><strong>UNÄ°TE AsistanÄ±</strong></p>
                        <p>Merhaba! ğŸ‘‹ Ben UNÄ°TE chatbot'u, size yardÄ±mcÄ± olmak iÃ§in buradayÄ±m.</p>
                        <p>Size ÅŸu konularda yardÄ±mcÄ± olabilirim:</p>
                        <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
                            <li>ğŸ“š Dersler - Ders iÃ§erikleri, zorluk seviyeleri, konular</li>
                            <li>ğŸ‘¨â€ğŸ« Hocalar - Hoca bilgileri, ofis saatleri, iletiÅŸim</li>
                            <li>ğŸ‰ Etkinlikler - Sosyal aktiviteler, topluluklar</li>
                            <li>ğŸ‘¥ EÅŸleÅŸtirme - Ãœst-alt sÄ±nÄ±f eÅŸleÅŸtirme, mentÃ¶rlÃ¼k</li>
                            <li>ğŸ« BÃ¶lÃ¼m - Genel bilgiler, sosyal dinamikler</li>
                        </ul>
                        <p style="margin-top: 1rem;"><em>NasÄ±l yardÄ±mcÄ± olabilirim?</em></p>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput"
                        placeholder="Sorunuzu yazÄ±n... (Ã¶rn: Veri YapÄ±larÄ± dersi hakkÄ±nda bilgi ver)"
                        autocomplete="off">
                    <button class="btn btn-primary" id="sendButton">
                        <span>GÃ¶nder</span> â¤
                    </button>
                </div>

                <!-- Suggestions -->
                <div id="suggestions"
                    style="padding: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap; border-top: 1px solid var(--glass-border);">
                    <button class="btn btn-secondary"
                        onclick="sendSuggestion('Veri YapÄ±larÄ± dersi hakkÄ±nda bilgi ver')">
                        ğŸ“š Veri YapÄ±larÄ± dersi
                    </button>
                    <button class="btn btn-secondary" onclick="sendSuggestion('YaklaÅŸan etkinlikler neler?')">
                        ğŸ‰ YaklaÅŸan etkinlikler
                    </button>
                    <button class="btn btn-secondary" onclick="sendSuggestion('NasÄ±l mentÃ¶r bulabilirim?')">
                        ğŸ‘¥ MentÃ¶r bul
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        const API_URL = 'http://localhost:3000/api';
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const suggestionsContainer = document.getElementById('suggestions');

        // Generate a session ID
        const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

        // Send message function
        async function sendMessage(message) {
            if (!message || !message.trim()) return;

            // Add user message to chat
            addMessage(message, 'user');

            // Clear input
            chatInput.value = '';

            // Show typing indicator
            const typingDiv = addTypingIndicator();

            try {
                const response = await fetch(`${API_URL}/chatbot/message`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        sessionId: sessionId
                    })
                });

                const data = await response.json();

                // Remove typing indicator
                typingDiv.remove();

                // Add bot response
                addMessage(data.answer, 'bot');

                // Update suggestions
                if (data.suggestions && data.suggestions.length > 0) {
                    updateSuggestions(data.suggestions);
                }

            } catch (error) {
                console.error('Error:', error);
                typingDiv.remove();
                addMessage('ÃœzgÃ¼nÃ¼m, bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.', 'bot');
            }
        }

        // Add message to chat
        function addMessage(text, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;

            if (type === 'bot') {
                // Convert markdown-like formatting to HTML
                let html = text
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\n\n/g, '</p><p>')
                    .replace(/\n/g, '<br>');

                messageDiv.innerHTML = `<div style="white-space: pre-wrap;"><p>${html}</p></div>`;
            } else {
                messageDiv.innerHTML = `<p>${escapeHtml(text)}</p>`;
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            return messageDiv;
        }

        // Add typing indicator
        function addTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message message-bot';
            typingDiv.innerHTML = '<p style="display: flex; align-items: center; gap: 0.5rem;">YazÄ±yor<span style="animation: pulse 1.5s ease-in-out infinite;">...</span></p>';
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return typingDiv;
        }

        // Update suggestions
        function updateSuggestions(suggestions) {
            suggestionsContainer.innerHTML = '';
            suggestions.slice(0, 3).forEach(suggestion => {
                const btn = document.createElement('button');
                btn.className = 'btn btn-secondary';
                btn.textContent = suggestion;
                btn.onclick = () => sendSuggestion(suggestion);
                suggestionsContainer.appendChild(btn);
            });
        }

        // Send suggestion
        function sendSuggestion(text) {
            chatInput.value = text;
            sendMessage(text);
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Event listeners
        sendButton.addEventListener('click', () => {
            sendMessage(chatInput.value);
        });

        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage(chatInput.value);
            }
        });

        // Focus input on load
        chatInput.focus();
    </script>
</body>

</html>